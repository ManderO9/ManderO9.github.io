<!DOCTYPE html>
<html lang="en">

<head>
    <!-- <base href="https://mandero9.github.io/website-source/"> -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CHETOUI Hossem</title>
    <link href="Assets/Css/style.css" rel="stylesheet" type="text/css" />
    <script defer src="./Assets/Js/base.js"></script>
    <script defer src="./Assets/Js/main.js"></script>
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MK3YCJ0RJT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MK3YCJ0RJT');
</script>

<header class="top-menu">
    <ul>
        <!-- LinkedIn icon -->
        <li>
            <a href="https://www.linkedin.com/in/hossem-chetoui" target="_blank">
                <svg fill="#ffffff" version="1.1" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" width="20px" height="20px" viewBox="0 0 512 512"
                    xml:space="preserve">
                    <g id="7935ec95c421cee6d86eb22ecd125aef">
                        <path style="display: inline; fill-rule: evenodd; clip-rule: evenodd;"
                            d="M116.504,500.219V170.654H6.975v329.564H116.504
                                L116.504,500.219z M61.751,125.674c38.183,0,61.968-25.328,61.968-56.953c-0.722-32.328-23.785-56.941-61.252-56.941
                                C24.994,11.781,0.5,36.394,0.5,68.722c0,31.625,23.772,56.953,60.53,56.953H61.751L61.751,125.674z M177.124,500.219
                                c0,0,1.437-298.643,0-329.564H286.67v47.794h-0.727c14.404-22.49,40.354-55.533,99.44-55.533
                                c72.085,0,126.116,47.103,126.116,148.333v188.971H401.971V323.912c0-44.301-15.848-74.531-55.497-74.531
                                c-30.254,0-48.284,20.38-56.202,40.08c-2.897,7.012-3.602,16.861-3.602,26.711v184.047H177.124L177.124,500.219z">
                        </path>
                    </g>
                </svg>
            </a>
        </li>

        <li><a href="./#contact-section" id="contact-link">Contact</a></li>
        <li><a href="./">Home</a></li>
    </ul>
</header>

<body>

<div class="contact-page">
    <div class="text">
        <p>You can dm me on <a href="https://www.linkedin.com/in/hossem-chetoui" class="big-link">LinkedIn</a>
            or send me a message here.</p>
        <p>Can't wait to hear what you've got to say !</p>
    </div>
    <div class="form">
        <form method="POST">
            <label for="email">Email</label>
            <input type="email" name="email" required maxlength="1000">
            <br>
            <label for="name">Name</label>
            <input type="text" name="name" maxlength="1000">
            <br>
            <label for="content">Your message</label>
            <textarea type="text" name="content" rows="5" required maxlength="10000"></textarea>
            <br>
            <div class="button-container">
                <button type="submit" class="simple-button">Send</button>
            </div>
        </form>
    </div>
    <div>
        <p>
            Message sent successfully
            <br><button class="simple-button">Ok</button>
        </p>
    </div>
    <div>
        <p>
            Oops! failed to send your message :( <br>
            <span id="error-message-container"></span>
            <br><button class="simple-button">Ok</button>
        </p>
    </div>
</div>


<script>
    // Server url
    const host = "https://websitebackend.somee.com";
    
    // Url to create a message
    const url = host + "/api/messages/create";

    // A flag indicating if we are already sending a request
    var sending = false;
    
    // The error message element
    const errorMessage = document.querySelector(".contact-page>div:nth-child(4)");

    // Displays an error to the user
    function DisplayError(error) {
        // Get the element that will contain the error message
        var errorContainer = document.querySelector("#error-message-container");

        // Set error in container
        errorContainer.textContent = error;

        // Display the error message
        errorMessage.style.opacity = "1";
        errorMessage.style.pointerEvents = "all";
    }

    // Gets run when we submit the contact form
    async function SubmitFunction(e) {
        // Prevent default behavior of submit
        e.preventDefault();

        // If we are already sending a request
        if (sending)
            // Don't do anything
            return;

        // Set sending flag to true
        sending = true;

        // The successs message element
        const successMessage = document.querySelector(".contact-page>div:nth-child(3)");

        // The submit button
        const sendButton = document.querySelector(".contact-page>div>form>.button-container>button");

        // The button that will get displayed with the success message
        const successButton = document.querySelector(".contact-page>div:nth-child(3)>p>button");

        // The button that will get displayed with the error message
        const failedButton = document.querySelector(".contact-page>div:nth-child(4)>p>button");

        // Set the send button to busy
        sendButton.textContent = "Sending...";

        // Try send the request
        try {
            // Create the request body
            var body = JSON.stringify({
                email: document.querySelector('input[name="email"]').value,
                name: document.querySelector('input[name="name"]').value,
                content: document.querySelector('textarea[name="content"]').value
            });

            // Send the request and get the response
            var response = await fetch(url, {
                method: "POST", body: body, headers: {
                    "Content-Type": "application/json"
                }
            });

            // If the request succeeded
            if (response.status == 200) {
                // Display success message
                successMessage.style.opacity = "1";
                successMessage.style.pointerEvents = "all";
            }
            // Otherwise, if it failed
            else {
                // Get the error from the body
                var error = await response.text();

                // If we have a too many requests response
                if (response.status == 429)
                    // Set error message to indicate it
                    error = "You have sent way too many messages";


                // If we have a service unavailable response
                if (response.status == 503)
                    // Set error message to indicate it
                    error = "Server is not currently available";


                // If we have an error message
                if (error)
                    // Set the error text to it
                    DisplayError("\"" + error + "\"");
                // Otherwise...
                else
                    // Set it to a generic error message
                    DisplayError("\"Unknown error\"");
            }
        }
        // If there was an erorr
        catch {
            DisplayError("Couldn't contact the server, unknown error")
        }

        // Reset the text of the send button
        sendButton.textContent = "Send";

        // Set sending flag to false
        sending = false;

        // Add click event to the failed button
        failedButton.addEventListener("click", () => {
            // On click hide the error message
            errorMessage.style.opacity = "0";
            errorMessage.style.pointerEvents = "none";
        });

        // Add click event to the success button
        successButton.addEventListener("click", () => {
            // On click hide the success message
            successMessage.style.opacity = "0";
            successMessage.style.pointerEvents = "none";

            // Clear all fields
            document.querySelector('input[name="email"]').value = "";
            document.querySelector('input[name="name"]').value = "";
            document.querySelector('textarea[name="content"]').value = "";

        });

    }

    // Get the contact form
    var form = document.querySelector("form");

    // Handle submit event ourselves
    form.addEventListener("submit", SubmitFunction);
</script>
    </body>
    <footer>
    </footer>
</html>